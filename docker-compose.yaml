services:
  radio:
    image: ${IMAGE_NAME:-radio-capture:latest}
    container_name: radio-capture
    restart: unless-stopped
    environment:
      - SECRET_KEY
      - DATABASE_URL
      - OPENAI_API_KEY
    ports:
      - "8000:8000"
    volumes:
      - ${DATA_DIR:-./data}:/data

  watcher:
    image: ${IMAGE_NAME:-radio-capture:latest}
    container_name: radio-capture-watcher
    restart: unless-stopped
    environment:
      - DATABASE_URL
      - OPENAI_API_KEY
      - HOME=/data
      - PANNS_CACHE_DIR=/data/models/panns
    command: ./start_watcher.sh
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    volumes:
      - ${DATA_DIR:-./data}:/data
    depends_on:
      - radio
